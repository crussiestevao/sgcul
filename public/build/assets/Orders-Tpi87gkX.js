import{r as n,j as e,b as I,Y as A,y as H}from"./app-XYcvX45B.js";import{H as W,O as Q}from"./OrderTablesList-DYf9aXxU.js";import{B as o,j as U,k as $,l as Y,n as Z,p as G,A as J,q as X,s as K}from"./AuthenticatedLayout-Dsx34QZr.js";import{M as ee}from"./index-bbd4PJy1.js";import{S as ae}from"./Skeleton-CtHg8bVf.js";import{F as u,I as b,b as N,R as te,C as T,a as L,S as se,d as q}from"./Table-DHwjyzK4.js";import{s as E}from"./index-BGnumeXB.js";import{P as M}from"./index-BfuchIVM.js";import{T as re}from"./index-Bka04zz8.js";import"./useForceUpdate-D1UJB1O2.js";function le({open:i,setOpen:x,stations:m=[],products:w=[],order:c={},setDataSource:S}){const j=n.useRef(null),[h,v]=n.useState([]),[k,g]=n.useState(!1),p=a=>new Promise(r=>setTimeout(r,a)),F=()=>{const a=j.current.getFieldsValue(),r=w.find(d=>d.id===a.product);a.code=r.code,a.name=r.name,a.id=r.id,v([...h,a])};n.useEffect(()=>{i===!0&&(g(!0),p(700).then(()=>{v(c==null?void 0:c.items),g(!1)}))},[i]);const y=async a=>{a.items=h,a.id=c.id;const r=m.find(d=>d.id===a.station||d.name===a.station);a.station=r.id,await I.post(route("order.update"),a).then(d=>{E.success("Requisiacao Actualizada"),S(d.data.data)}).then(()=>{})};return e.jsx(e.Fragment,{children:e.jsx(ee,{open:i,onCancel:()=>x(!1),title:"Editar Requisicao",width:1e3,footer:null,children:k?e.jsx(ae,{active:!0}):e.jsxs(e.Fragment,{children:[e.jsxs(u,{layout:"vertical",ref:j,initialValues:c,onFinish:y,children:[e.jsxs("div",{className:"shadow p-4 bg-white",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx(u.Item,{label:"Codigo da requisicao (Opcional)",name:"code",className:"w-1/2",children:e.jsx(b,{placeholder:"Opcional",allowClear:!0,readOnly:!0})}),e.jsx(u.Item,{className:"w-1/2",label:"Motorista",name:"driver",rules:[{required:!0,message:"Indique o motorista"}],children:e.jsx(b,{placeholder:"Motorista",allowClear:!0})})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(u.Item,{className:"w-1/2",label:"Matricula",name:"registration",rules:[{required:!0,message:"Indique a matricula"}],children:e.jsx(b,{placeholder:"Viatura",allowClear:!0})}),e.jsx(u.Item,{className:"w-1/2",label:"Estação",name:"station",rules:[{required:!0,message:"Selecione uma estação "}],children:e.jsx(N,{placeholder:"Estação",showSearch:!0,optionFilterProp:"children",allowClear:!0,children:m==null?void 0:m.map((a,r)=>e.jsx(N.Option,{value:a.id,children:a.name},r))})})]}),e.jsx(u.Item,{label:"Observação (Nota)",name:"notes",children:e.jsx(b.TextArea,{placeholder:"Observação",allowClear:!0})})]}),e.jsx("div",{className:"shadow p-4 bg-white mt-4",children:e.jsxs(te,{gutter:12,children:[e.jsx(T,{xs:10,children:e.jsx(u.Item,{label:"Productos",name:"product",children:e.jsx(N,{placeholder:"Productos",showSearch:!0,optionFilterProp:"children",children:w.map((a,r)=>e.jsx(N.Option,{value:a.id,children:a.name},r))})})}),e.jsx(T,{xs:8,children:e.jsx(u.Item,{label:"Quantidade",name:"quantity",children:e.jsx(b,{type:"number",placeholder:"Quantidade",allowClear:!0,minLength:1,min:1})})}),e.jsx(T,{children:e.jsx(u.Item,{label:" ",children:e.jsxs(o,{className:"flex gap-1 bg-red-400 text-white",onClick:()=>F(),children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"size-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})}),"Adicionr Item"]})})})]})})]}),e.jsxs("div",{className:"shadow-lg bg-white mt-4 p-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{}),e.jsxs(o,{className:"flex gap-1 bg-green-400 text-white mb-4",disabled:!((h==null?void 0:h.length)>0),onClick:()=>j.current.submit(),children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"size-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9 9 6-6m0 0 6 6m-6-6v12a6 6 0 0 1-12 0v-3"})}),"Actualizar"]})]}),e.jsx(L,{dataSource:h,columns:[{key:"code",dataIndex:"code",title:"Codigo"},{key:"name",dataIndex:"name",title:"Producto"},{key:"qty",dataIndex:"quantity",title:"Quantidade"},{key:"remove",title:"Opcoes",render:a=>e.jsx(e.Fragment,{children:e.jsx(o,{color:"red",onClick:()=>{const r=h.filter(d=>d.id!=a.id);v(r)},children:"Remover"})})}]})]})]})})})}function ie({dataSource:i=[],setDataSource:x,setValidated:m,stations:w,products:c}){const[S,j]=n.useState(""),[h,v]=n.useState(""),k=n.useRef(null),[g,p]=n.useState(!1),[F,y]=n.useState(!1),[a,r]=n.useState(null),d=async t=>{const s=i.filter(l=>l.id!=t);x(s);try{await I.put(route("order.delete",t)).then(()=>{}).catch(()=>{})}catch(l){console.log(l)}},P=(t,s,l)=>{s(),j(t[0]),v(l)},V=t=>{t(),j("")},f=t=>({filterDropdown:({setSelectedKeys:s,selectedKeys:l,confirm:O,clearFilters:R,close:_})=>e.jsxs("div",{style:{padding:8},onKeyDown:C=>C.stopPropagation(),children:[e.jsx(b,{ref:k,placeholder:`Buscar por ${t}`,value:l[0],onChange:C=>s(C.target.value?[C.target.value]:[]),onPressEnter:()=>P(l,O,t),style:{marginBottom:8,display:"block"}}),e.jsxs(se,{children:[e.jsx(o,{type:"primary",onClick:()=>P(l,O,t),icon:e.jsx(q,{}),size:"small",style:{width:90},children:"Buscar"}),e.jsx(o,{onClick:()=>R&&V(R),size:"small",style:{width:90},children:"Limpar"}),e.jsx(o,{type:"link",size:"small",onClick:()=>{O({closeDropdown:!1}),j(l[0]),v(t)},children:"Filtrar"}),e.jsx(o,{type:"link",size:"small",onClick:()=>{_()},children:"Fechar"})]})]}),filterIcon:s=>e.jsx(q,{style:{color:s?"#1677ff":void 0}}),onFilter:(s,l)=>l[t].toString().toLowerCase().includes(s.toLowerCase()),onFilterDropdownOpenChange:s=>{s&&setTimeout(()=>{var l;return(l=k.current)==null?void 0:l.select()},100)},render:s=>h===t?e.jsx(W,{highlightStyle:{backgroundColor:"#ffc069",padding:0},searchWords:[S],autoEscape:!0,textToHighlight:s?s.toString():""}):s}),z=async t=>{p(!0),await I.get(route("order.validate.one",t)).then(s=>{p(!1),x(s.data)}).catch(s=>{p(!1)})},B=async t=>{p(!0),await I.post(route("order.validate.all")).then(s=>{m(s.data.data),x([]),p(!1),E.success("Lista das validadas foi actualizada")}).catch(s=>{p(!1)})},D=[{title:"Data de Emissao",dataIndex:"created_at",key:"created_at",...f("created_at")},{title:"Codigo",dataIndex:"code",key:"code",...f("code")},{title:"Tipo",dataIndex:"type",key:"type",...f("type")},{title:"Total",dataIndex:"amount",key:"amount",...f("amount")},{title:"Estaco de servico",dataIndex:"station",key:"station",...f("station")},{title:"Matricula",dataIndex:"registration",key:"registration",...f("registration")},{title:"Motorista",dataIndex:"driver",key:"driver",...f("driver")},{title:"Detalhes ?",key:"opts",render:t=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(M,{title:`Validar Operação ${t.code} ?`,description:"Click em SIM para Confirmar",okText:"SIM",cancelText:"Fechar",okButtonProps:{className:"bg-red-400 pl-4"},onConfirm:()=>z(t.id),children:e.jsx(o,{icon:e.jsx($,{}),className:"bg-red-400 text-white",loading:g,children:"Validar-Operacao"})}),e.jsx(M,{title:`Cancelar Operação ${t.code} ?`,description:"Deseja Cancelar",okText:"SIM",cancelText:"Fechar",okButtonProps:{className:"bg-red-400 pl-4"},onConfirm:()=>d(t.id),children:e.jsx(o,{icon:e.jsx(Y,{}),className:"bg-yellow-400 text-white",loading:g,children:"Cancelar"})}),e.jsx(o,{onClick:()=>{r(t),y(!0)},icon:e.jsx(Z,{}),className:"bg-green-400 text-white",loading:g,children:"Editar"}),e.jsx(o,{onClick:()=>{window.open(route("order.print",t.id),"_blank","width=800,height=500,top=200,left=200")},icon:e.jsx(G,{}),className:"bg-gray-800 text-white",children:"Imprimir"})]})})}];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{}),e.jsx(M,{title:"Validar todas Operações ?",description:e.jsx("p",{className:"text-red-400 font-bold",children:"Opção  perigosa, confirme caso tenha certeza"}),okText:"SIM",cancelText:"Fechar",okButtonProps:{className:"bg-red-400 pl-4"},placement:"left",onConfirm:()=>B(),children:e.jsx(o,{disabled:!(i.length>0),className:"mb-4 bg-red-400 text-white",icon:e.jsx(U,{}),loading:g,children:"Validar Todas"})})]}),e.jsx(L,{dataSource:i,columns:D,rowHoverable:!1,rowClassName:t=>"cursor-pointer hover:bg-blue-400 font-normal hover:text-white"}),e.jsx(le,{open:F,setOpen:y,stations:w,products:c,order:a,setDataSource:x})]})}function ge(i){const[x,m]=n.useState(i.validated_orders.data),[w,c]=n.useState(i.unvalidated_orders.data);return e.jsxs(J,{user:i.auth.user,page:"Requisição",header:e.jsx("h2",{className:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight",children:"Requisição"}),children:[e.jsx(A,{title:"Requisicao"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{}),e.jsxs(o,{className:"flex gap-2",type:"primary",onClick:()=>{H.get(route("order.new"))},children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"size-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 7.5h1.5m-1.5 3h1.5m-7.5 3h7.5m-7.5 3h7.5m3-9h3.375c.621 0 1.125.504 1.125 1.125V18a2.25 2.25 0 0 1-2.25 2.25M16.5 7.5V18a2.25 2.25 0 0 0 2.25 2.25M16.5 7.5V4.875c0-.621-.504-1.125-1.125-1.125H4.125C3.504 3.75 3 4.254 3 4.875V18a2.25 2.25 0 0 0 2.25 2.25h13.5M6 7.5h3v3H6v-3Z"})}),e.jsx("p",{children:"Emitir uma nova Requisição "})]})]}),e.jsx(re,{items:[{key:"1",label:e.jsxs("p",{className:"flex gap-1 text-base",children:[e.jsx(X,{}),"Operações Pendentes"]}),children:e.jsx(ie,{dataSource:w,setDataSource:c,stations:i.stations,products:i.products,setValidated:m})},{key:"2",label:e.jsxs("p",{className:"flex gap-1 text-base",children:[e.jsx(K,{})," Validados"]}),children:e.jsx(Q,{dataSource:x})}]})]})}export{ge as default};
